{% extends 'lecturer/base_lecturer.html' %}
{% block title %}View Past Attendance{% endblock %}

{% block lecturer_content %}
<div class="max-w-3xl mx-auto bg-white/10 backdrop-blur-lg p-8 rounded-2xl border border-white/20 shadow-2xl mt-14">
  <h2 class="text-3xl font-bold text-white mb-10 text-center tracking-tight drop-shadow">Past Attendance Lookup</h2>

  <form method="post" class="flex flex-col gap-6 mb-8">
    {% csrf_token %}
    <div class="flex flex-col sm:flex-row gap-4 items-center justify-center">
      <div>
        <label for="{{ form.course.id_for_label }}" class="block text-white font-medium mb-1 text-sm">
          {{ form.course.label }}
        </label>
        {{ form.course }}
        {% if form.course.errors %}
          <p class="text-red-400 text-xs mt-1">{{ form.course.errors.0 }}</p>
        {% endif %}
      </div>
      <div>
        <label for="{{ form.date.id_for_label }}" class="block text-white font-medium mb-1 text-sm">
          {{ form.date.label }}
        </label>
        {{ form.date }}
        {% if form.date.errors %}
          <p class="text-red-400 text-xs mt-1">{{ form.date.errors.0 }}</p>
        {% endif %}
      </div>
      <button type="submit"
        class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg font-semibold shadow transition-all duration-200">
        View
      </button>
    </div>
    {% if attendance_list and selected_course %}
      <div class="flex flex-wrap gap-2 items-center justify-center mt-2">
        <!-- Day -->
        <a href="{% url 'lecturer:export_attendance' %}?course={{ selected_course.id }}&date={{ selected_date|date:'d-m-Y' }}"
           class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-medium transition">
          Export CSV (Day)
        </a>
        <!-- Month -->
        <a href="{% url 'lecturer:export_attendance' %}?course={{ selected_course.id }}&date={{ selected_date|date:'Y-m-01' }}&monthly=1"
           class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-medium transition">
          Export CSV (Month)
        </a>
        <!-- All (for this course) -->
        <a href="{% url 'lecturer:export_attendance' %}?course={{ selected_course.id }}&all=1"
           class="bg-amber-700 hover:bg-amber-800 text-white px-4 py-2 rounded-lg font-medium transition">
          Export All
        </a>
      </div>
    {% endif %}
  </form>

  <style>
    select, input[type="date"] {
      background-color: rgba(31, 41, 55, 0.28);
      color: white;
      border-radius: 0.5rem;
      padding: 0.5rem 1rem;
      border: 1px solid rgba(255,255,255,0.18);
      outline: none;
      width: 100%;
      transition: border 0.2s, box-shadow 0.2s;
    }
    select:focus, input[type="date"]:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 2px #2563eb33;
    }
    option {
      background: rgba(31, 41, 55, 0.8);
      color: white;
    }
    table { font-size: 1rem; }
  </style>

  {% if attendance_list is not None %}
    <div class="mb-4">
      <h3 class="text-xl font-semibold text-white mb-1">
        {{ selected_course.name|default:"(Course not selected)" }}
      </h3>
      <span class="text-gray-300 text-base">
        {{ selected_date|date:"D, d M Y" }}
      </span>
    </div>
    {% if attendance_list %}
      <div class="overflow-x-auto rounded-xl">
        <table class="w-full bg-white/5 rounded-xl shadow">
          <thead class="bg-white/10 text-white">
            <tr>
              <th class="p-4 text-left font-semibold">Student</th>
              <th class="p-4 text-center font-semibold">Status</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in attendance_list %}
            <tr class="border-t border-white/10 hover:bg-white/10 transition">
              <td class="p-4 text-white text-lg">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-blue-700/40 rounded-full flex items-center justify-center text-white text-base font-bold uppercase">
                    {{ entry.student.user.get_full_name|slice:":1" }}
                  </div>
                  <span>{{ entry.student.user.get_full_name }}</span>
                </div>
              </td>
              <td class="p-4 text-center">
                {% if entry.status == "present" %}
                  <span class="inline-block px-4 py-1 bg-green-600/80 text-white rounded-full font-medium">Present</span>
                {% elif entry.status == "absent" %}
                  <span class="inline-block px-4 py-1 bg-red-500/80 text-white rounded-full font-medium">Absent</span>
                {% else %}
                  <span class="inline-block px-4 py-1 bg-gray-400 text-white rounded-full font-medium">Not Marked</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-center text-gray-300 mt-8 text-lg">No students enrolled for this course on this day.</div>
    {% endif %}
  {% endif %}
</div>
{% endblock %}
