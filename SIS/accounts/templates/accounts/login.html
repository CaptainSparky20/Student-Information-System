{% extends "base.html" %}
{% load static widget_tweaks %}

{% block title %}Login{% endblock %}

{% block content %}
<div class="relative flex items-center justify-center min-h-[70vh] p-6">

  <!-- Outer container without background -->
  <div class="rounded-2xl shadow-2xl p-10 max-w-md w-full fade-in-up">

    <!-- Typing message container -->
    <div id="typing-message" class="text-center text-purple-700 font-extrabold text-xl select-none mb-6 min-h-[3rem]"></div>

    <!-- Login form container with translucent white background -->
    <div id="login-form"
         class="opacity-0 translate-y-6 transition-opacity transition-transform duration-700 bg-white bg-opacity-90 rounded-xl p-8 shadow-lg"
         style="display:none;">

      <!-- Logo inside the form -->
      <div class="flex justify-center mb-8">
        <img src="{% static 'images/breyer.jpg' %}" alt="ACC College Logo" class="w-72 h-auto rounded-lg" loading="lazy" />
      </div>

      <h2 class="text-3xl font-extrabold mb-6 text-center text-purple-700 select-none">LOGIN YOUR DASHBAORD</h2>

      {% if messages %}
        <div class="mb-4 text-red-600 text-center font-semibold">
          {% for message in messages %}
            <p>{{ message }}</p>
          {% endfor %}
        </div>
      {% endif %}

      <form method="post" novalidate class="space-y-6">
        {% csrf_token %}

        <div>
          <label for="{{ form.email.id_for_label }}" class="block mb-2 font-semibold text-gray-700">Email</label>
          {{ form.email|add_class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition" }}
          {% for error in form.email.errors %}
            <p class="text-red-600 text-sm mt-1">{{ error }}</p>
          {% endfor %}
        </div>

        <div>
          <label for="{{ form.password.id_for_label }}" class="block mb-2 font-semibold text-gray-700">Password</label>
          {{ form.password|add_class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition" }}
          {% for error in form.password.errors %}
            <p class="text-red-600 text-sm mt-1">{{ error }}</p>
          {% endfor %}
        </div>

        <button type="submit"
                class="w-full py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 transition focus:outline-none focus:ring-4 focus:ring-purple-300">
          Log In
        </button>
      </form>
    </div>

  </div>

</div>

<!-- Fade-in-up animation styles -->
<style>
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(15px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .fade-in-up {
    animation: fadeInUp 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
</style>

<!-- Typing effect script with skip and smooth login form animation -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const message = "WELCOME TO BREYER STUDENT INFORMATION SYSTEM CREATED BY FYP GROUP ALESYA!";
    const typingElement = document.getElementById('typing-message');
    const loginForm = document.getElementById('login-form');
    let index = 0;
    let typingInterval;
    let skipped = false;

    function showLoginForm() {
      loginForm.style.display = 'block';
      void loginForm.offsetWidth;
      loginForm.classList.remove('opacity-0', 'translate-y-6');
      loginForm.classList.add('opacity-100', 'translate-y-0');
    }

    function finishTyping() {
      if (skipped) return;
      skipped = true;
      clearInterval(typingInterval);
      typingElement.textContent = message;
      typingElement.style.opacity = '0';
      typingElement.style.transition = 'opacity 0.6s ease';
      setTimeout(() => {
        typingElement.style.display = 'none';
        showLoginForm();
      }, 600);

      document.removeEventListener('click', skipTyping);
      document.removeEventListener('keydown', skipTyping);
    }

    function type() {
      if (index < message.length) {
        typingElement.textContent += message.charAt(index);
        index++;
      } else {
        clearInterval(typingInterval);
        setTimeout(() => {
          typingElement.style.opacity = '0';
          setTimeout(() => {
            typingElement.style.display = 'none';
            showLoginForm();
          }, 600);
          document.removeEventListener('click', skipTyping);
          document.removeEventListener('keydown', skipTyping);
        }, 1500);
      }
    }

    function skipTyping() {
      finishTyping();
    }

    typingInterval = setInterval(type, 50);

    document.addEventListener('click', skipTyping);
    document.addEventListener('keydown', skipTyping);
  });
</script>
{% endblock %}
